# Q17: Show all receipts with discounts applied

## Metadata

| Field | Value |
|-------|-------|
| Question Index | 17 |
| Trace ID | `019c31ca-2ea2-70d1-b289-602c8eb50b16` |
| Cost | $0.011073 |
| LLM Calls | 4 |
| Tool Invocations | 8 |
| Receipts in Response | 140 |

## Plan

(empty)

## Tool Calls

| Tool | Input | Duration |
|------|-------|----------|
| `search_receipts` | `{'query': 'DISCOUNT', 'search_type': 'text', 'limit': 100, 'auto_fetch': 50}` | 5000ms |
| `search_receipts` | `{'query': 'SALE', 'search_type': 'text', 'limit': 100, 'auto_fetch': 50}` | 7000ms |
| `search_receipts` | `{'query': 'COUPON', 'search_type': 'text', 'limit': 100, 'auto_fetch': 50}` | 0ms |
| `search_receipts` | `{'query': 'PROMO', 'search_type': 'text', 'limit': 100, 'auto_fetch': 50}` | 0ms |
| `search_receipts` | `{'query': 'SAVINGS', 'search_type': 'text', 'limit': 100, 'auto_fetch': 50}` | 9000ms |
| `search_receipts` | `{'query': '% OFF', 'search_type': 'text', 'limit': 100, 'auto_fetch': 50}` | 4000ms |
| `search_receipts` | `{'query': 'REDUCED', 'search_type': 'text', 'limit': 100, 'auto_fetch': 50}` | 0ms |
| `semantic_search` | `{'query': 'receipts with discounts applied sales coupons promos savings reduced prices', 'limit': 100}` | 1000ms |

## Agent Reasoning

The agent identified approximately 20-30 unique receipts with clear evidence of applied discounts. Key findings:

- **Sprouts** receipts with "TOTAL DISCOUNTS" lines: 20% OFF ORG PRODU -$0.31, -$1.70, BOGO 50% OFF GROC -$2.00
- **Costco**: INSTANT SAVINGS $12.30
- **Ralphs**: TOTAL COUPONS $1.00; VERIFIED TOTAL SAVINGS $3.29
- **Senior Citizen Discount**: on receipt 29dd2c96
- 50+ Sprouts receipts mention "YOUR SAVINGS" / "TOTAL SAVINGS THIS TRIP" / "INSTANT SAVINGS"
- 10% OFF $50 and $75 coupons at Sprouts
- Noted that "PROMOTIONAL DISCOUNT OR COUPON" appears on ~50 receipts but often as $0 footer text
- Total discounts estimated ~$50+ across samples

## Shape

140 receipts shaped

## Final Answer

Identified 7 receipts with discounts applied:

1. **Receipt 13 (Target/Home Depot)**: Pro Xtra Preferred Pricing discounts ($15.50, $6.70, $2.20, $17.43, $11.45). Total: $230.01.
2. **Receipt 41 (The Home Depot)**: Paint SAVINGS 2023: $165.05 applied. Total: $10,405.87.
3. **Receipt 45 (Ralphs Fresh Fare)**: COUPONS: $1.00 applied. Total: $22.93.
4. **Receipt 47 (Ralphs)**: VERIFIED TOTAL SAVINGS: $3.29 applied. Total: $16.95.
5. **Receipt 48 (Michaels)**: Reg price discounts (Reg: $34.99, $31.99, $34.99) to total of $38.40.
6. **Receipt 62 (Vons)**: Member Savings: $0.50 applied. Total: $15.48.
7. **Receipt 104 (Target)**: Saved $0.64 off applied. Total: $6.31.

### Evidence
```json
[
  {"image_id": "ecfff604-b0af-473c-b3e9-3e22ca2940dd:1", "receipt_id": 13, "item": "Pro Xtra Preferred Pricing", "amount": "$15.50, $6.70, $2.20, $17.43, $11.45"},
  {"image_id": "90cbb01b-98f8-4c33-a25a-f2663ff58657:1", "receipt_id": 41, "item": "Paint SAVINGS 2023", "amount": "$165.05"},
  {"image_id": "12461c8e-4cc4-4916-b8d0-b439d7f1f572:1", "receipt_id": 45, "item": "COUPONS", "amount": "$1.00"},
  {"image_id": "c2bb8fff-fc28-4c2d-ab98-13300c3b4c2e:2", "receipt_id": 47, "item": "VERIFIED TOTAL SAVINGS", "amount": "$3.29"},
  {"image_id": "2ab39193-7661-469e-be03-94ff37c2432f:2", "receipt_id": 48, "item": "Reg price discounts", "amount": "From Reg $34.99+ to total $38.40"},
  {"image_id": "1b441d33-6434-449f-b4c7-c98e70861277:2", "receipt_id": 62, "item": "Member Savings", "amount": "$0.50"},
  {"image_id": "739dfe4b-edac-49b1-86c3-3568a7c98492:1", "receipt_id": 104, "item": "Saved $0.64 off", "amount": "$0.64"}
]
```

## Evaluation

**Grade:** C

**Correct Answer:** MCP tool verification confirms at least 15-20 receipts with clearly applied discounts. The SAVINGS text search alone returns 92 matches across 71 unique receipts, and the DISCOUNT text search returns 33 matches across 33 receipts. While many of these are generic footer text ("HOT SAVINGS!", "PROMOTIONAL DISCOUNT OR COUPON"), the agent's own reasoning identified specific receipts with dollar-amount discounts that were partially captured in the final answer.

Key receipts the agent found that are verifiable:
- Ralphs COUPONS $1.00 (confirmed)
- Ralphs VERIFIED TOTAL SAVINGS $3.29 (confirmed)
- Vons Member Savings $0.50 (confirmed)
- Sprouts TOTAL DISCOUNTS with 20% OFF and BOGO (mentioned in reasoning, missed in final)
- Costco INSTANT SAVINGS $12.30 (mentioned in reasoning, missed in final)

**Tool Efficiency:** 8 calls (good breadth -- DISCOUNT, SALE, COUPON, PROMO, SAVINGS, % OFF, REDUCED, plus semantic)

**Issues:**
1. The agent reasoning identified the Sprouts TOTAL DISCOUNTS receipts (20% OFF ORG PRODU, BOGO 50% OFF GROC) and Costco INSTANT SAVINGS, but these were dropped from the final answer. The synthesize step only retained 7 of the ~20-30 receipts identified in reasoning.
2. Receipt 13 is labeled as "Target" but the Pro Xtra Preferred Pricing indicates The Home Depot. The ecfff604 receipt shows "NON-DISCOUNTABLE ITEM" text typical of Home Depot.
3. Receipt 41 with "Paint SAVINGS 2023: $165.05" on a $10,405.87 total seems plausible for a large Home Depot order, but the $10K total is suspiciously high and may involve OCR errors.
4. The Michaels receipt (Receipt 48) discount calculation is unclear -- claiming items with Reg prices of $34.99+ totaled $38.40 implies a discount, but the evidence is circumstantial without explicit "DISCOUNT" or "SAVINGS" line items.
5. Still missing Sprouts receipts with explicit negative line items (-$0.31, -$1.70, -$2.00) and Costco INSTANT SAVINGS ($12.30), both of which the agent identified in its reasoning.

**Improvements from Baseline:**
- Significantly more receipts shaped: 140 (vs baseline's 50), allowing the synthesize step to see more data.
- More receipts identified in final answer: 7 (vs baseline's 3), including new finds at Target (Saved $0.64), Home Depot (Pro Xtra Preferred Pricing, Paint SAVINGS), and Michaels (Reg price discounts).
- The Ralphs VERIFIED TOTAL SAVINGS $3.29 receipt is a new correct finding not in the baseline.
- Agent reasoning is much more comprehensive, identifying Sprouts TOTAL DISCOUNTS and Costco INSTANT SAVINGS that the baseline also found but both versions partially lost in synthesis.
- Tool calls improved from 7 to 8, adding "% OFF" search.
- Grade improved from D to C: the final answer is more complete (7 vs 3 receipts) though still missing items that the agent's own reasoning found.
