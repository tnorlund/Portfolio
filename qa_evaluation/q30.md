# Q30: What's my average tip at restaurants?

## Metadata

| Field | Value |
|-------|-------|
| Question Index | 30 |
| Trace ID | `019c31cd-7894-7873-b12f-894c88d5afae` |
| Cost | $0.0156 |
| LLM Calls | 5 |
| Tool Invocations | 18 |
| Receipts in Response | 114 |

## Plan

(empty)

## Tool Calls

| Tool | Input | Duration |
|------|-------|----------|
| `list_categories` | `{}` | 1000ms |
| `search_receipts` | `{'query': 'TIP', 'search_type': 'label', 'limit': 200, 'auto_fetch': 50}` | 0ms |
| `search_receipts` | `{'query': 'GRATUITY', 'search_type': 'label', 'limit': 200, 'auto_fetch': 50}` | 0ms |
| `search_receipts` | `{'query': 'TIP', 'search_type': 'text', 'limit': 200, 'auto_fetch': 50}` | 2000ms |
| `search_receipts` | `{'query': 'GRATUITY', 'search_type': 'text', 'limit': 200, 'auto_fetch': 50}` | 1000ms |
| `search_product_lines` | `{'query': 'TIP', 'search_type': 'text', 'limit': 200}` | 1000ms |
| `search_product_lines` | `{'query': 'GRATUITY', 'search_type': 'text', 'limit': 200}` | 0ms |
| `get_receipt_summaries` | `{'category_filter': 'restaurant', 'limit': 1000}` | 1000ms |
| `aggregate_amounts` | `{'label_type': 'LINE_TOTAL', 'filter_text': 'TIP'}` | 0ms |
| `aggregate_amounts` | `{'label_type': 'LINE_TOTAL', 'filter_text': 'GRATUITY'}` | 0ms |
| `search_product_lines` | `{'query': 'tip', 'search_type': 'semantic', 'limit': 200}` | 0ms |
| `get_receipt` | `{'image_id': 'f8100916-94fc-4121-9fc5-f9f046c711a7', 'receipt_id': 1}` | 0ms |
| `get_receipt` | `{'image_id': '2c453d65-edae-4aeb-819a-612b27d99894', 'receipt_id': 1}` | 0ms |
| `get_receipt` | `{'image_id': 'ce0da565-da87-4a7d-9525-aa0cd7b3b75c', 'receipt_id': 2}` | 0ms |
| `get_receipt` | `{'image_id': 'c914012e-3fc3-4ba2-b314-fa7d423acac8', 'receipt_id': 1}` | 0ms |
| `get_receipt` | `{'image_id': '06e54f95-6c95-4567-9fe4-6d5803e8c04d', 'receipt_id': 1}` | 0ms |
| `get_receipt` | `{'image_id': '942be309-1647-48a5-bd77-cc220528cf0a', 'receipt_id': 2}` | 0ms |
| `get_receipt` | `{'image_id': 'a8d7ab9f-efcf-44d8-8512-0fe30186b40c', 'receipt_id': 4}` | 0ms |

## Agent Reasoning

### Agent Step 2 (52000ms)

(empty -- initial reasoning)

### Agent Step 4 (65000ms)

(empty -- second reasoning pass after tool results)

### Agent Step 6 (21000ms)

**Your average tip at restaurants is about $2.40.**

Across restaurant-category receipts (including delis, cafes, Mexican, American, etc., totaling 108 receipts from get_receipt_summaries), explicit tips were recorded on ~7-8 receipts where you added a gratuity:

- **$4.06** at Moody Market & Provisions (deli)
- **$4.00** at Brent's Delicatessen & Restaurant (deli/restaurant; "TIP: 4")
- **$3.44** at Los Agaves (Mexican restaurant)
- **$2.30** at Neighborly (restaurant; from summaries)
- **$1.55** at Neighborly (restaurant)
- **$1.44** at Dog Haus (American restaurant)
- **$1.37** at Pressed Juicery (juice shop/cafe; borderline restaurant)
- **$0.80** at Urbane Cafe (restaurant)

**Total tips: ~$18.96 across 8 instances** (excluding false positives like "tri-tip" meat or pre-tip subtotals). Average: **$2.37**. Most receipts (100+) had no tip line or $0 tip (e.g., fast food like In-N-Out, or suggested gratuity only). Pre-computed summaries show $2.30 total parsed tip across all, aligning with sparse tipping.

## Shape

114 receipts shaped

## Final Answer

**Your average recorded tip at restaurants is $2.56**, based on the 4 receipts that explicitly list a "TIP" amount (out of 108 total restaurant receipts). Total tips: $10.25.

### Recorded Tips:
- **Brent's Delicatessen & Restaurant** (Receipt 1): $4.00 (pre-tip total: $24.38)
- **Pressed Juicery** (Receipt 5): $1.37 (pre-tip total: $15.39)
- **Dog Haus** (Receipt 12): $1.44 (pre-tip total: $30.28)
- **Los Agaves** (Receipt 20): $3.44 (pre-tip total: $28.57)

**Note**: Most restaurant receipts (e.g., Mastro's Steakhouse, In-N-Out Burger, Sushi Planet, Ranch Hand BBQ) do not list explicit tip amounts, so they could not be included -- possibly $0 tips, cash tips, or data not captured via OCR. Some have ambiguous "%" lines (e.g., potentially suggested gratuities at Sun Nong Dan or Brent's), but only clear "TIP"/"Tip" entries were used.

### Evidence
```json
[
  {
    "image_id": "942be309-1647-48a5-bd77-cc220528cf0a:2",
    "receipt_id": "1",
    "item": "TIP::",
    "amount": 4.00
  },
  {
    "image_id": "c914012e-3fc3-4ba2-b314-fa7d423acac8:1",
    "receipt_id": "5",
    "item": "TIP::",
    "amount": 1.37
  },
  {
    "image_id": "ce0da565-da87-4a7d-9525-aa0cd7b3b75c:2",
    "receipt_id": "12",
    "item": "TIP AMOUNT:",
    "amount": 1.44
  },
  {
    "image_id": "383a90d8-1d0e-46f4-9f8a-5f2313d9e983:2",
    "receipt_id": "20",
    "item": "Tip:",
    "amount": 3.44
  }
]
```

## Evaluation

**Grade:** C

**Correct Answer:** There are 12 restaurant receipts with identifiable tip amounts. The verifiable tips are:

| Merchant | Image ID | Tip Amount | Method |
|----------|----------|------------|--------|
| Moody Market & Provisions | f8100916 | $4.06 | "TIP: $4.06" |
| Brent's Deli | 942be309 | $4.00 | "TIP: 4", total $24.38 - subtotal $20.38 |
| The Stand | 016bda87 | $3.78 | "Tips $3.78" |
| Los Agaves | 383a90d8 | $3.44 | "Tip $3.44" |
| Neighborly (a8d7ab9f) | a8d7ab9f | $2.30 | Pre-computed summary field |
| Neighborly (2c453d65) | 2c453d65 | $1.55 | "TIP (THANKS!) $1.55" |
| La La Land Kind Cafe | a762ca4d | $1.50 | "Tip $1.50" |
| Dog Haus | ce0da565 | $1.44 | "TIP AMOUNT $1.44" |
| Pressed Juicery | c914012e | $1.37 | "TIP: $1.37" |
| Urbane Cafe | 06e54f95 | $0.80 | "TIP AMOUNT $0.80" |
| Ranch Hand BBQ | 0a345fdd | $8.00 | Total $57.87 - Amount $49.87 = $8.00 |
| Sun Nong Dan | 94676cfe | $52.99 | "GRATUITY: 52.99" on receipt |

Total tips: $85.23 across 12 receipts. Average: approximately $7.10. Excluding the Sun Nong Dan outlier ($52.99 gratuity on a $264.95 subtotal group meal), the average of the remaining 11 tips is $2.93.

The agent's final answer of $2.56 (from 4 receipts) is in the right ballpark for small tips but significantly undercounts the number of tipping receipts.

**Tool Efficiency:** 18 calls (reasonable). The agent searched by label and text for both "TIP" and "GRATUITY", used product line searches, fetched receipt summaries, and retrieved individual receipts. The aggregate_amounts calls returned nothing useful, but otherwise the search strategy was systematic.

**Issues:**
1. The agent reasoning (step 6) correctly identified 8 tips totaling $18.96 for a $2.37 average, but the synthesizer narrowed this down to only 4 tips totaling $10.25. The shape step apparently discarded several valid tip entries that the agent had already found.
2. The final answer missed The Stand $3.78 (labeled "Tips" on line 24 of the receipt), La La Land Kind Cafe $1.50 (labeled "Tip" on line 20), Moody Market $4.06 ("TIP: $4.06"), Neighborly $1.55 and $2.30, Urbane Cafe $0.80, Ranch Hand BBQ $8.00 (derivable from total minus subtotal), and Sun Nong Dan $52.99 ("GRATUITY:" line).
3. The synthesizer's conservative approach of only including receipts with explicit "TIP"/"Tip" labels was understandable but excluded the GRATUITY label at Sun Nong Dan and the tip-by-subtraction at Ranch Hand BBQ.
4. The agent correctly filtered out false positives like "TRI TIP" (meat), "LOWESTIPRICES" (Harbor Freight), and "015-029 TIP" (Home Depot spray tip), which is good.
5. The Brent's Deli receipt f008ea77 shows "TIP: 22 38" with blank TOTAL -- this is garbled OCR (likely "TIP: ___" followed by check amount). The agent correctly excluded this ambiguous entry.

**Improvements from Baseline:**
- The baseline answer was $22.60 average from 9 receipts ($203.39 total), which included fabricated amounts like $156.85 for Sun Nong Dan and $13.96/$14.62 for Ranch Hand BBQ. The hybrid shaping version's final answer of $2.56 is much closer to reality (the median tip excluding the outlier is about $2.00).
- The agent reasoning step now correctly identified 8 tips including Moody Market $4.06, Urbane Cafe $0.80, and Neighborly $2.30/$1.55 -- these were missed in the baseline agent reasoning.
- No fabricated numbers appear in the hybrid version. All 4 cited evidence amounts ($4.00, $1.37, $1.44, $3.44) are verifiably correct on the actual receipts.
- The synthesizer was overly conservative compared to the agent reasoning, dropping valid tips that the agent had found. This is the opposite problem from the baseline, which hallucinated amounts.
- Grade improved from D to C: the answer is defensible (correct for the 4 receipts cited) but incomplete. The baseline was outright wrong with fabricated data.
