# Upload Images Infrastructure

This directory defines the `UploadImages` Pulumi component used to accept
receipt images and process their OCR results. It wires together S3, API
Gateway, Lambda and SQS so that uploaded images can be routed through the OCR
pipeline provided by the `receipt_upload` package.

## Resources

- **Image Bucket** – S3 bucket where raw images are stored. The front end
  uploads directly using presigned URLs generated by the `upload_receipt`
  Lambda.
- **Queues** – an `ocr_queue` for new OCR jobs and an `ocr_results_queue`
  for processed JSON results.
- **API Gateway** – exposes a `/upload-receipt` endpoint which proxies to
  the `upload_receipt` Lambda.
- **Lambdas**
  - `upload_receipt.py` – creates an OCR job record in DynamoDB, provides a
    presigned upload URL and pushes the job ID onto `ocr_queue`.
  - `process_ocr_results.py` – triggered by `ocr_results_queue`; downloads
    the OCR JSON and image, classifies the receipt type and performs further
    processing before updating DynamoDB or scheduling refinement jobs.

Both Lambdas depend on the `receipt_upload` Python package. The package is
built as a Lambda layer (`upload_layer` in `infra/lambda_layer.py`) and
provides utilities for SQS messaging, OCR parsing, image routing and receipt
refinement. By sharing this layer, the infrastructure reuses the same
processing logic that is documented in `receipt_upload/README.md`.
