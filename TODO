# TODO: OCR Cleanup & Bounding Box Mapping Pipeline

## 1. Re-run OCR on Cropped Receipts
- [ ] **Prepare Cropped Receipt Images**
  - [ ] Confirm you have the corners (coordinates) for each cropped receipt.
  - [ ] List or index all cropped images to process.
- [ ] **Execute OCR on Cropped Images**
  - [ ] Run the OCR process on each cropped receipt.
  - [ ] Save the new OCR outputs with their bounding box coordinates.

## 2. Map Original Bounding Boxes to Cleaned OCR Boxes
- [ ] **Load Original OCR Labels**
  - [ ] Retrieve original bounding box labels (from first pass) for each receipt.
- [ ] **Design a Mapping Algorithm**
  - [ ] Develop or select an algorithm to match original bounding boxes with the new cleaned ones.
    - Consider using techniques such as Intersection over Union (IoU) or nearest neighbor matching.
    - Handle cases where there isnâ€™t a one-to-one match (e.g., when a box is split or merged).
- [ ] **Implement Mapping Logic**
  - [ ] For each original bounding box, find the best matching cleaned OCR box (or boxes) based on overlap, proximity, or confidence.
  - [ ] Optionally, flag cases where the match is ambiguous or below a defined threshold.
- [ ] **Validate the Mapped Bounding Boxes**
  - [ ] Visually or programmatically check that the mapping between original and cleaned bounding boxes is accurate.
  - [ ] Refine the matching criteria as necessary.

## 3. Update Data in DynamoDB
- [ ] **Plan Database Update**
  - [ ] Decide if the new OCR boxes with mapped original labels should update existing records or be stored as new entries.
- [ ] **Implement Update Scripts**
  - [ ] Write/update scripts to:
    - Adjust new OCR bounding boxes using the mapping.
    - Retain and link original human labels.
  - [ ] Ensure that updates maintain associations between receipts, lines, and words.
- [ ] **Test Database Changes**
  - [ ] Verify that the mapped labels are correctly reflected in DynamoDB.
  - [ ] Check for consistency and accuracy across all item types.

## 4. Testing and Final Validation
- [ ] **Subset Testing**
  - [ ] Run the pipeline on a small batch of receipts.
  - [ ] Validate that original labels map correctly to the cleaned OCR results.
- [ ] **Iterate and Refine**
  - [ ] Adjust mapping criteria if necessary.
  - [ ] Log any issues and fix them iteratively.
- [ ] **Final Review**
  - [ ] Perform a final check on the overall process before scaling to all receipts.